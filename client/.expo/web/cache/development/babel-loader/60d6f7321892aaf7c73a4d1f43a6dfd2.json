{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport { Base64, getDataUrlParts, hasOwnProperty, isInteger, isNumber, isObject, isString, isUndefined, pathChild, pathLastComponent, pathParent, ReferenceBase, toFilePath } from '@react-native-firebase/app/lib/common';\nimport StorageDownloadTask from \"./StorageDownloadTask\";\nimport StorageListResult, { provideStorageReferenceClass } from \"./StorageListResult\";\nimport StorageStatics from \"./StorageStatics\";\nimport StorageUploadTask from \"./StorageUploadTask\";\nimport { validateMetadata } from \"./utils\";\n\nvar StorageReference = function (_ReferenceBase) {\n  _inherits(StorageReference, _ReferenceBase);\n\n  var _super = _createSuper(StorageReference);\n\n  function StorageReference(storage, path) {\n    var _this;\n\n    _classCallCheck(this, StorageReference);\n\n    _this = _super.call(this, path);\n    _this._storage = storage;\n    return _this;\n  }\n\n  _createClass(StorageReference, [{\n    key: \"child\",\n    value: function child(path) {\n      var childPath = pathChild(this.path, path);\n      return new StorageReference(this._storage, childPath);\n    }\n  }, {\n    key: \"delete\",\n    value: function _delete() {\n      return this._storage.native.delete(this.toString());\n    }\n  }, {\n    key: \"getDownloadURL\",\n    value: function getDownloadURL() {\n      return this._storage.native.getDownloadURL(this.toString());\n    }\n  }, {\n    key: \"getMetadata\",\n    value: function getMetadata() {\n      return this._storage.native.getMetadata(this.toString());\n    }\n  }, {\n    key: \"list\",\n    value: function list(options) {\n      var _this2 = this;\n\n      if (!isUndefined(options) && !isObject(options)) {\n        throw new Error(\"firebase.storage.StorageReference.list(*) 'options' expected an object value.\");\n      }\n\n      var listOptions = {\n        maxResults: 1000\n      };\n\n      if (options) {\n        if (hasOwnProperty(options, 'maxResults')) {\n          if (!isNumber(options.maxResults) || !isInteger(options.maxResults)) {\n            throw new Error(\"firebase.storage.StorageReference.list(*) 'options.maxResults' expected a number value.\");\n          }\n\n          if (options.maxResults < 1 || options.maxResults > 1000) {\n            throw new Error(\"firebase.storage.StorageReference.list(*) 'options.maxResults' expected a number value between 1-1000.\");\n          }\n\n          listOptions.maxResults = options.maxResults;\n        }\n\n        if (options.pageToken) {\n          if (!isString(options.pageToken)) {\n            throw new Error(\"firebase.storage.StorageReference.list(*) 'options.pageToken' expected a string value.\");\n          }\n\n          listOptions.pageToken = options.pageToken;\n        }\n      }\n\n      return this._storage.native.list(this.toString(), listOptions).then(function (data) {\n        return new StorageListResult(_this2._storage, data);\n      });\n    }\n  }, {\n    key: \"listAll\",\n    value: function listAll() {\n      var _this3 = this;\n\n      return this._storage.native.listAll(this.toString()).then(function (data) {\n        return new StorageListResult(_this3._storage, data);\n      });\n    }\n  }, {\n    key: \"put\",\n    value: function put(data, metadata) {\n      var _this4 = this;\n\n      if (!isUndefined(metadata)) {\n        validateMetadata(metadata);\n      }\n\n      return new StorageUploadTask(this, function (task) {\n        return Base64.fromData(data).then(function (_ref) {\n          var string = _ref.string,\n              format = _ref.format;\n\n          var _this4$_updateString = _this4._updateString(string, format, metadata),\n              _string = _this4$_updateString._string,\n              _format = _this4$_updateString._format,\n              _metadata = _this4$_updateString._metadata;\n\n          return _this4._storage.native.putString(_this4.toString(), _string, _format, _metadata, task._id);\n        });\n      });\n    }\n  }, {\n    key: \"putString\",\n    value: function putString(string) {\n      var _this5 = this;\n\n      var format = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : StorageStatics.StringFormat.RAW;\n      var metadata = arguments.length > 2 ? arguments[2] : undefined;\n\n      var _this$_updateString = this._updateString(string, format, metadata),\n          _string = _this$_updateString._string,\n          _format = _this$_updateString._format,\n          _metadata = _this$_updateString._metadata;\n\n      return new StorageUploadTask(this, function (task) {\n        return _this5._storage.native.putString(_this5.toString(), _string, _format, _metadata, task._id);\n      });\n    }\n  }, {\n    key: \"toString\",\n    value: function toString() {\n      if (this.path.length <= 1) {\n        return \"\" + this._storage._customUrlOrRegion;\n      }\n\n      return this._storage._customUrlOrRegion + \"/\" + this.path;\n    }\n  }, {\n    key: \"updateMetadata\",\n    value: function updateMetadata(metadata) {\n      validateMetadata(metadata);\n      return this._storage.native.updateMetadata(this.toString(), metadata);\n    }\n  }, {\n    key: \"writeToFile\",\n    value: function writeToFile(filePath) {\n      var _this6 = this;\n\n      if (!isString(filePath)) {\n        throw new Error(\"firebase.storage.StorageReference.writeToFile(*) 'filePath' expects a string value.\");\n      }\n\n      return new StorageDownloadTask(this, function (task) {\n        return _this6._storage.native.writeToFile(_this6.toString(), toFilePath(filePath), task._id);\n      });\n    }\n  }, {\n    key: \"putFile\",\n    value: function putFile(filePath, metadata) {\n      var _this7 = this;\n\n      if (!isUndefined(metadata)) {\n        validateMetadata(metadata);\n      }\n\n      if (!isString(filePath)) {\n        throw new Error(\"firebase.storage.StorageReference.putFile(*, _) 'filePath' expects a string value.\");\n      }\n\n      return new StorageUploadTask(this, function (task) {\n        return _this7._storage.native.putFile(_this7.toString(), toFilePath(filePath), metadata, task._id);\n      });\n    }\n  }, {\n    key: \"_updateString\",\n    value: function _updateString(string, format, metadata) {\n      if (!isString(string)) {\n        throw new Error(\"firebase.storage.StorageReference.putString(*, _, _) 'string' expects a string value.\");\n      }\n\n      if (!Object.values(StorageStatics.StringFormat).includes(format)) {\n        throw new Error(\"firebase.storage.StorageReference.putString(_, *, _) 'format' provided is invalid, must be one of \" + Object.values(StorageStatics.StringFormat).join(',') + \".\");\n      }\n\n      if (!isUndefined(metadata)) {\n        validateMetadata(metadata);\n      }\n\n      var _string = string;\n      var _format = format;\n      var _metadata = metadata;\n\n      if (format === StorageStatics.StringFormat.RAW) {\n        _string = Base64.btoa(_string);\n        _format = StorageStatics.StringFormat.BASE64;\n      } else if (format === StorageStatics.StringFormat.DATA_URL) {\n        var _getDataUrlParts = getDataUrlParts(_string),\n            mediaType = _getDataUrlParts.mediaType,\n            base64String = _getDataUrlParts.base64String;\n\n        if (isUndefined(base64String)) {\n          throw new Error('firebase.storage.StorageReference.putString(*, _, _) invalid data_url string provided.');\n        }\n\n        if (isUndefined(metadata) || isUndefined(metadata.contentType)) {\n          if (isUndefined(metadata)) {\n            _metadata = {};\n          }\n\n          _metadata.contentType = mediaType;\n          _string = base64String;\n          _format = StorageStatics.StringFormat.BASE64;\n        }\n      }\n\n      return {\n        _string: _string,\n        _metadata: _metadata,\n        _format: _format\n      };\n    }\n  }, {\n    key: \"bucket\",\n    get: function get() {\n      return this._storage._customUrlOrRegion.replace('gs://', '');\n    }\n  }, {\n    key: \"fullPath\",\n    get: function get() {\n      return this.path;\n    }\n  }, {\n    key: \"name\",\n    get: function get() {\n      return pathLastComponent(this.path);\n    }\n  }, {\n    key: \"parent\",\n    get: function get() {\n      var parentPath = pathParent(this.path);\n\n      if (parentPath === null) {\n        return parentPath;\n      }\n\n      return new StorageReference(this._storage, parentPath);\n    }\n  }, {\n    key: \"root\",\n    get: function get() {\n      return new StorageReference(this._storage, '/');\n    }\n  }, {\n    key: \"storage\",\n    get: function get() {\n      return this._storage;\n    }\n  }]);\n\n  return StorageReference;\n}(ReferenceBase);\n\nexport { StorageReference as default };\nprovideStorageReferenceClass(StorageReference);","map":{"version":3,"sources":["D:/mobile-app/client/node_modules/@react-native-firebase/storage/lib/StorageReference.js"],"names":["Base64","getDataUrlParts","hasOwnProperty","isInteger","isNumber","isObject","isString","isUndefined","pathChild","pathLastComponent","pathParent","ReferenceBase","toFilePath","StorageDownloadTask","StorageListResult","provideStorageReferenceClass","StorageStatics","StorageUploadTask","validateMetadata","StorageReference","storage","path","_storage","childPath","native","delete","toString","getDownloadURL","getMetadata","options","Error","listOptions","maxResults","pageToken","list","then","data","listAll","metadata","task","fromData","string","format","_updateString","_string","_format","_metadata","putString","_id","StringFormat","RAW","length","_customUrlOrRegion","updateMetadata","filePath","writeToFile","putFile","Object","values","includes","join","btoa","BASE64","DATA_URL","mediaType","base64String","contentType","replace","parentPath"],"mappings":"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","sourcesContent":["/* eslint-disable no-console */\n/*\n * Copyright (c) 2016-present Invertase Limited & Contributors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this library except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n\nimport {\n  Base64,\n  getDataUrlParts,\n  hasOwnProperty,\n  isInteger,\n  isNumber,\n  isObject,\n  isString,\n  isUndefined,\n  pathChild,\n  pathLastComponent,\n  pathParent,\n  ReferenceBase,\n  toFilePath,\n} from '@react-native-firebase/app/lib/common';\nimport StorageDownloadTask from './StorageDownloadTask';\nimport StorageListResult, { provideStorageReferenceClass } from './StorageListResult';\nimport StorageStatics from './StorageStatics';\nimport StorageUploadTask from './StorageUploadTask';\nimport { validateMetadata } from './utils';\n\nexport default class StorageReference extends ReferenceBase {\n  constructor(storage, path) {\n    super(path);\n    this._storage = storage;\n  }\n\n  /**\n   * @url https://firebase.google.com/docs/reference/js/firebase.storage.Reference#bucket\n   */\n  get bucket() {\n    return this._storage._customUrlOrRegion.replace('gs://', '');\n  }\n\n  /**\n   * @url https://firebase.google.com/docs/reference/js/firebase.storage.Reference#fullPath\n   */\n  get fullPath() {\n    return this.path;\n  }\n\n  /**\n   * @url https://firebase.google.com/docs/reference/js/firebase.storage.Reference#name\n   */\n  get name() {\n    return pathLastComponent(this.path);\n  }\n\n  /**\n   * @url https://firebase.google.com/docs/reference/js/firebase.storage.Reference#parent\n   */\n  get parent() {\n    const parentPath = pathParent(this.path);\n    if (parentPath === null) {\n      return parentPath;\n    }\n    return new StorageReference(this._storage, parentPath);\n  }\n\n  /**\n   * @url https://firebase.google.com/docs/reference/js/firebase.storage.Reference#root\n   */\n  get root() {\n    return new StorageReference(this._storage, '/');\n  }\n\n  /**\n   * @url https://firebase.google.com/docs/reference/js/firebase.storage.Reference#storage\n   */\n  get storage() {\n    return this._storage;\n  }\n\n  /**\n   * @url https://firebase.google.com/docs/reference/js/firebase.storage.Reference#child\n   */\n  child(path) {\n    const childPath = pathChild(this.path, path);\n    return new StorageReference(this._storage, childPath);\n  }\n\n  /**\n   * @url https://firebase.google.com/docs/reference/js/firebase.storage.Reference#delete\n   */\n  delete() {\n    return this._storage.native.delete(this.toString());\n  }\n\n  /**\n   * @url https://firebase.google.com/docs/reference/js/firebase.storage.Reference#getDownloadURL\n   */\n  getDownloadURL() {\n    return this._storage.native.getDownloadURL(this.toString());\n  }\n\n  /**\n   * @url https://firebase.google.com/docs/reference/js/firebase.storage.Reference#getMetadata\n   */\n  getMetadata() {\n    return this._storage.native.getMetadata(this.toString());\n  }\n\n  /**\n   * @url https://firebase.google.com/docs/reference/js/firebase.storage.Reference#list\n   */\n  list(options) {\n    if (!isUndefined(options) && !isObject(options)) {\n      throw new Error(\n        \"firebase.storage.StorageReference.list(*) 'options' expected an object value.\",\n      );\n    }\n\n    const listOptions = {\n      maxResults: 1000,\n    };\n\n    if (options) {\n      if (hasOwnProperty(options, 'maxResults')) {\n        if (!isNumber(options.maxResults) || !isInteger(options.maxResults)) {\n          throw new Error(\n            \"firebase.storage.StorageReference.list(*) 'options.maxResults' expected a number value.\",\n          );\n        }\n\n        if (options.maxResults < 1 || options.maxResults > 1000) {\n          throw new Error(\n            \"firebase.storage.StorageReference.list(*) 'options.maxResults' expected a number value between 1-1000.\",\n          );\n        }\n\n        listOptions.maxResults = options.maxResults;\n      }\n\n      if (options.pageToken) {\n        if (!isString(options.pageToken)) {\n          throw new Error(\n            \"firebase.storage.StorageReference.list(*) 'options.pageToken' expected a string value.\",\n          );\n        }\n\n        listOptions.pageToken = options.pageToken;\n      }\n    }\n\n    return this._storage.native\n      .list(this.toString(), listOptions)\n      .then(data => new StorageListResult(this._storage, data));\n  }\n\n  /**\n   * @url https://firebase.google.com/docs/reference/js/firebase.storage.Reference#listAll\n   */\n  listAll() {\n    return this._storage.native\n      .listAll(this.toString())\n      .then(data => new StorageListResult(this._storage, data));\n  }\n\n  /**\n   * @url https://firebase.google.com/docs/reference/js/firebase.storage.Reference#put\n   */\n  put(data, metadata) {\n    if (!isUndefined(metadata)) {\n      validateMetadata(metadata);\n    }\n\n    return new StorageUploadTask(this, task =>\n      Base64.fromData(data).then(({ string, format }) => {\n        const { _string, _format, _metadata } = this._updateString(string, format, metadata);\n        return this._storage.native.putString(\n          this.toString(),\n          _string,\n          _format,\n          _metadata,\n          task._id,\n        );\n      }),\n    );\n  }\n\n  /**\n   * @url https://firebase.google.com/docs/reference/js/firebase.storage.Reference#putString\n   */\n  putString(string, format = StorageStatics.StringFormat.RAW, metadata) {\n    const { _string, _format, _metadata } = this._updateString(string, format, metadata);\n\n    return new StorageUploadTask(this, task =>\n      this._storage.native.putString(this.toString(), _string, _format, _metadata, task._id),\n    );\n  }\n\n  /**\n   * @url https://firebase.google.com/docs/reference/js/firebase.storage.Reference#fullPath\n   */\n  toString() {\n    if (this.path.length <= 1) {\n      return `${this._storage._customUrlOrRegion}`;\n    }\n\n    return `${this._storage._customUrlOrRegion}/${this.path}`;\n  }\n\n  /**\n   * @url https://firebase.google.com/docs/reference/js/firebase.storage.Reference#updateMetadata\n   */\n  updateMetadata(metadata) {\n    validateMetadata(metadata);\n    return this._storage.native.updateMetadata(this.toString(), metadata);\n  }\n\n  /* ----------------------------------------\n   *   EXTRA APIS (DO NOT ON EXIST WEB SDK)\n   * ---------------------------------------- */\n\n  /**\n   * @url https://firebase.google.com/docs/reference/js/firebase.storage.Reference\n   */\n  writeToFile(filePath) {\n    if (!isString(filePath)) {\n      throw new Error(\n        \"firebase.storage.StorageReference.writeToFile(*) 'filePath' expects a string value.\",\n      );\n    }\n\n    return new StorageDownloadTask(this, task =>\n      this._storage.native.writeToFile(this.toString(), toFilePath(filePath), task._id),\n    );\n  }\n\n  /**\n   * @url https://firebase.google.com/docs/reference/js/firebase.storage.Reference\n   */\n  putFile(filePath, metadata) {\n    if (!isUndefined(metadata)) {\n      validateMetadata(metadata);\n    }\n\n    if (!isString(filePath)) {\n      throw new Error(\n        \"firebase.storage.StorageReference.putFile(*, _) 'filePath' expects a string value.\",\n      );\n    }\n\n    return new StorageUploadTask(this, task =>\n      this._storage.native.putFile(this.toString(), toFilePath(filePath), metadata, task._id),\n    );\n  }\n\n  _updateString(string, format, metadata) {\n    if (!isString(string)) {\n      throw new Error(\n        \"firebase.storage.StorageReference.putString(*, _, _) 'string' expects a string value.\",\n      );\n    }\n\n    if (!Object.values(StorageStatics.StringFormat).includes(format)) {\n      throw new Error(\n        `firebase.storage.StorageReference.putString(_, *, _) 'format' provided is invalid, must be one of ${Object.values(\n          StorageStatics.StringFormat,\n        ).join(',')}.`,\n      );\n    }\n\n    if (!isUndefined(metadata)) {\n      validateMetadata(metadata);\n    }\n\n    let _string = string;\n    let _format = format;\n    let _metadata = metadata;\n\n    if (format === StorageStatics.StringFormat.RAW) {\n      _string = Base64.btoa(_string);\n      _format = StorageStatics.StringFormat.BASE64;\n    } else if (format === StorageStatics.StringFormat.DATA_URL) {\n      const { mediaType, base64String } = getDataUrlParts(_string);\n      if (isUndefined(base64String)) {\n        throw new Error(\n          'firebase.storage.StorageReference.putString(*, _, _) invalid data_url string provided.',\n        );\n      }\n\n      if (isUndefined(metadata) || isUndefined(metadata.contentType)) {\n        if (isUndefined(metadata)) {\n          _metadata = {};\n        }\n        _metadata.contentType = mediaType;\n        _string = base64String;\n        _format = StorageStatics.StringFormat.BASE64;\n      }\n    }\n    return { _string, _metadata, _format };\n  }\n}\n\nprovideStorageReferenceClass(StorageReference);\n"]},"metadata":{},"sourceType":"module"}